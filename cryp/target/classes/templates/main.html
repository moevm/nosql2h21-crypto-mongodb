<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.2/css/bootstrap.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.2/js/bootstrap.bundle.min.js"></script>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"
            type="text/javascript"></script>
    <script src="https://code.highcharts.com/highcharts.src.js"></script>
    <!-- - -->

    <!-- - -->
</head>
<body>

<a href="http://localhost:8080/mainPage">Главная</a>

<div id="container1" style="width: 700px; height: 400px "></div>

<div class="container fluid text-center">
    <div class="m-2"><a class="h3" th:href="@{/history/new}">Добавить новую валюту</a></div>
    <div><h2>Список валют</h2></div>
        <div class="border border-secondary rounded p-3">
            <div class="form-row justify-content-center align-items-center">
                <label class="align-items-center col-sm-4 col-form-label font-weight-bold">Импорт данных:</label>
                <input value="имя"type="file" id="currency_json" accept=".json">
                <div class="text-center">
                    <button onclick="sendJSON()" class="btn btn-primary m-2">Отправить</button>
                </div>
            </div>
            <div class="form-row text-center">
                <div class="col-12">
                    <a th:href="@{/currency/get_currency_jsons}">Эскпорт данных</a>
                </div>
            </div>
        </div>
    <div>
        <p>Поиск валюты:</p>
        <p>По имени:</p>
        <form th:action="@{/currency/getCurrencyByName}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="text" name="text" class="search" placeholder="Название валюты">
            <input type="submit" name="submit" class="submit">
        </form>
        <p>По стоимости:</p>
        <form th:action="@{/currency/getCurrencyByPrice}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="text" name="text" class="search" placeholder="Минимальная стоимость">
            <input type="text" name="text" class="search" placeholder="Максимальная стоимость">
            <input type="submit" name="submit" class="submit">
        </form>
        <p>По дате:</p>
        <form th:action="@{/currency/getCurrencyByDate}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="text" name="text" class="search" placeholder="Дата начала:">
            <input type="text" name="text" class="search" placeholder="Дата конца:">
            <input type="submit" name="submit" class="submit">
        </form>
    </div>

<!--    ***********************************************-->

<!--    <div>-->
<!--        <p>Калькулятор и конвертер криптовалют</p>-->

<!--        <div class="border border-secondary rounded p-3">-->

<!--            <div class="dropdown">-->
<!--                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdown_coins" data-toggle="dropdown" aria-haspopup="true"-->
<!--                        aria-expanded="false">-->
<!--                    Coin-->
<!--                </button>-->
<!--                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdown_coins" data-toggle="dropdown" aria-haspopup="true"-->
<!--                        aria-expanded="false">-->
<!--                    Coin-->
<!--                </button>-->
<!--                <div id="menu" class="dropdown-menu" aria-labelledby="dropdown_coins">-->
<!--                    <form class="px-4 py-2">-->
<!--                        <input type="search" class="form-control" id="searchCoin" placeholder="BTC" autofocus="autofocus">-->
<!--                    </form>-->
<!--                    <div id="menuItems"></div>-->
<!--                    <div id="empty" class="dropdown-header">No coins found</div>-->
<!--                </div>-->
<!--            </div>-->


<!--        </div>-->

<!--    </div>-->

    <!--    ***********************************************-->
    <div>
        <table class="table table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th><a th:href="@{/currency/name_filter}">Название</a></th>
                    <th><a th:href="@{/currency/price_filter}">Стоимость</a></th>
                    <th><a th:href="@{/currency/time_filter}">Время</a></th>
                </tr>
            </thead>
            <tbody>


            <th:block th:each="currency : ${currencies}">
                <tr>
                    <td><p th:text="${currency.asset_id}"></p></td>
                    <td><p th:text="${currency.price_usd}"></p></td>
                    <td><p th:text="${currency.data_end}"></p></td>
                </tr>
            </th:block>


            </tbody>
        </table>
    </div>
</div>
<a th:href="@{/mainPage}">Главная</a>


<script type="text/javascript" >
    const fileUploader = document.getElementById('currency_json');
    var fileread = new FileReader();
    var jsonObject;
    var jsonString;

    fileUploader.addEventListener('change',
        (event) => {
            const files = event.target.files;
            //console.log('files', files);
            var file    = document.querySelector('input[type=file]').files[0];
            //console.log('files2', file);
            var reader  = new FileReader();

            reader.readAsText(file);

            reader.onload = function() {
                jsonString = reader.result;
                jsonString = jsonString.toString();
                //console.log(reader.result);
            };
        }
    );



    function sendJSON(){

        let xhr = new XMLHttpRequest();
        let url = "http://localhost:8080/history/saveJSON";
        xhr.open("POST", url, true);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        xhr.send(jsonString);
    }

</script>
</body>
</html>