<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"
            type="text/javascript"></script>
    <script src="https://code.highcharts.com/highcharts.src.js"></script>
    <!-- - -->

    <!-- - -->
</head>
<body>

<a href="http://localhost:8080/mainPage">Главная</a>


<div class="container fluid text-center">
    <div class="m-2"><a class="h3" th:href="@{/history/new}">Добавить новую валюту</a></div>
    <div><h2>Список валют</h2></div>
        <div class="border border-secondary rounded p-3">
            <div class="form-row justify-content-center align-items-center">
                <label class="align-items-center col-sm-4 col-form-label font-weight-bold">Импорт данных:</label>
                <input value="имя"type="file" id="currency_json" accept=".json">
                <div class="text-center">
                    <button onclick="sendJSON()" class="btn btn-primary m-2">Отправить</button>
                </div>
            </div>
            <div class="form-row text-center">
                <div class="col-12">
                    <a th:href="@{/currency/get_currency_jsons}">Эскпорт данных</a>
                </div>
            </div>
        </div>
    <div>



        <p>Поиск валюты:</p>
        <p>По имени:</p>
        <form th:action="@{/currency/getCurrencyByName}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="text" name="text" class="search" placeholder="Название валюты">
            <input type="submit" name="submit" class="submit">
        </form>
        <p>По стоимости:</p>
        <form th:action="@{/currency/getCurrencyByPrice}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="number" step="0.01" name="rateMin" class="search" placeholder="Минимальная стоимость">
            <input type="number" step="0.01" name="rateMax" class="search" placeholder="Максимальная стоимость">
            <input type="submit" name="submit" class="submit">
        </form>
        <p>По дате:</p>
        <form th:action="@{/currency/getCurrencyByDate}" method="get" style="max-width: 500px; margin:0 auto;">
            <input type="date" name="dateMin" class="search" placeholder="Дата начала:">
            <input type="date" name="dateMax" class="search" placeholder="Дата конца:">
            <input type="submit" name="submit" class="submit">
        </form>

    </div>
    <div>
        <table class="table table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th><a th:href="@{/currency/name_filter}">Название</a></th>
                    <th><a th:href="@{/currency/price_filter}">Стоимость</a></th>
                    <th><a th:href="@{/currency/time_filter}">Время</a></th>
                </tr>
            </thead>
            <tbody>
            <th:block th:each="currency : ${currencies}">
                <tr>
                    <td><p th:text="${currency.asset_id}"></p></td>
                    <td><p th:text="${currency.price_usd}"></p></td>
                    <td><p th:text="${currency.data_end}"></p></td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </div>
</div>
<a th:href="@{/mainPage}">Главная</a>


<script type="text/javascript" >
    const fileUploader = document.getElementById('currency_json');
    var fileread = new FileReader();
    var jsonObject;
    var jsonString;

    fileUploader.addEventListener('change',
        (event) => {
            const files = event.target.files;
            //console.log('files', files);
            var file    = document.querySelector('input[type=file]').files[0];
            //console.log('files2', file);
            var reader  = new FileReader();

            reader.readAsText(file);

            reader.onload = function() {
                jsonString = reader.result;
                jsonString = jsonString.toString();
                //console.log(reader.result);
            };
        }
    );



    function sendJSON(){

        let xhr = new XMLHttpRequest();
        let url = "http://localhost:8080/history/saveJSON";
        xhr.open("POST", url, true);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        xhr.send(jsonString);
    }

</script>
</body>
</html>