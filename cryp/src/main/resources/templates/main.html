<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
</head>
<body>
<div class="container fluid text-center">
    <div class="m-2"><a class="h3" th:href="@{/history/new}">Добавить новую валюту</a></div>
    <div><h2>Список валют</h2></div>
        <div class="border border-secondary rounded p-3">
            <div class="form-group row">
                <label class="col-sm-4 col-form-label">Экспорт данных</label>
                <div class="col-sm-8">
                    <input type="file" id="currency_json" accept=".json">
                </div>
            <div class="text-center">
                <button onclick="sendJSON()" class="btn btn-primary m-2">Отправить</button>
            </div>
        </div>
        </div>
    <div>
        <table class="table table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Название</th>
                    <th>Стоимость</th>
                    <th>Время</th>
                </tr>
            </thead>
            <tbody>
            <th:block th:each="currency : ${currencies}">
                <tr>
                    <td><p th:text="${currency.asset_id}"></p></td>
                    <td><p th:text="${currency.price_usd}"></p></td>
                    <td><p th:text="${currency.data_end}"></p></td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </div>
</div>
<a th:href="@{/mainPage}">Главная</a>
<script type="text/javascript" >
    const fileUploader = document.getElementById('currency_json');
    var fileread = new FileReader();
    var jsonObject;
    var jsonString;

    fileUploader.addEventListener('change',
        (event) => {
            const files = event.target.files;
            //console.log('files', files);
            var file    = document.querySelector('input[type=file]').files[0];
            //console.log('files2', file);
            var reader  = new FileReader();

            reader.readAsText(file);

            reader.onload = function() {
                jsonString = reader.result;
                jsonString = jsonString.toString();
                //console.log(reader.result);
            };
        }
    );



    function sendJSON(){

        let xhr = new XMLHttpRequest();
        let url = "http://localhost:8080/history/saveJSON";
        xhr.open("POST", url, true);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        xhr.send(jsonString);
    }

</script>
</body>
</html>